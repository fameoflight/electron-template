/**
 * {{className}}Base - Generated base entity class
 *
 * ⚠️ DO NOT EDIT THIS FILE DIRECTLY ⚠️
 * This file is auto-generated from schemas/{{className}}.json
 *
 * To customize this entity:
 * 1. Edit main/db/entities/{{className}}.ts (extends this class)
 * 2. Modify schemas/{{className}}.json and run: yarn graphql
 */

// Core imports
import { ObjectType, Field, ID, registerEnumType } from 'type-graphql';
import { Entity, Column, Index, ManyToOne, OneToMany, ManyToMany, OneToOne, JoinColumn, RelationId, ObjectLiteral } from 'typeorm';
import { GraphQLJSONObject } from 'graphql-type-json';
import { z } from 'zod';
import { FieldColumnEnum, FieldColumn, FieldColumnJSON } from '@main/base/graphql/decorators/index.js';

// Validation imports
import {
  IsString,
  IsNumber,
  IsBoolean,
  IsDate,
  IsUUID,
  IsOptional,
  IsNotEmpty,
  MinLength,
  MaxLength,
  Min,
  Max,
  Matches,
  IsEnum,
  IsObject,
  IsUrl,
  IsEmail,
  ValidateNested,
  ArrayMinSize,
  ArrayMaxSize,
  IsArray,
  IsNotEmptyObject,
  IsDefined
} from 'class-validator';

// Base entity
import { OwnedEntity } from '@base/db/OwnedEntity.js';
import { DataSourceProvider } from '@base/db/index.js';

// Dynamic entity imports (if any relationships exist)
{{#each imports}}
{{{this}}}
{{/each}}

{{#if hasEnums}}
// ──────────────────────────────────────────────────────────────────────────
// Enum Definitions
// ──────────────────────────────────────────────────────────────────────────

{{#each enums}}
export enum {{name}} {
{{#each values}}
  {{this}} = '{{this}}'{{#unless @last}},{{/unless}}
{{/each}}
}

{{/each}}
{{/if}}

{{#if hasJsonInterfaces}}
// ──────────────────────────────────────────────────────────────────────────
// JSON Interface Definitions
// ──────────────────────────────────────────────────────────────────────────

{{#each jsonInterfaces}}
{{{definition}}}

{{/each}}
{{/if}}

{{#if hasJsonInterfaces}}
// ──────────────────────────────────────────────────────────────────────────
// Zod Schema Definitions for JSON Array Items
// ──────────────────────────────────────────────────────────────────────────

{{#each zodSchemas}}
{{{definition}}}

{{/each}}
{{/if}}

@ObjectType()
export abstract class {{className}}Base extends OwnedEntity {
{{#each fields}}
  {{#each decorators}}
  {{{this}}}
  {{/each}}
  {{name}}{{nullability}}: {{{tsType}}};

{{/each}}
{{#if hasRelationships}}
  // ──────────────────────────────────────────────────────────────────────────
  // Relationships
  // ──────────────────────────────────────────────────────────────────────────

{{#each relationships}}
  {{#each decorators}}
  {{{this}}}
  {{/each}}
  {{name}}{{nullability}}: {{{tsType}}};

{{/each}}
{{/if}}
{{#if hasPolymorphic}}
  // ──────────────────────────────────────────────────────────────────────────
  // Polymorphic Methods
  // ──────────────────────────────────────────────────────────────────────────

{{#each polymorphicMethods}}
  /**
   * Gets the polymorphic {{fieldName}} entity
   */
  async {{getterName}}<T extends ObjectLiteral>(): Promise<T | null> {
    if (!this.{{idColumn}} || !this.{{typeColumn}}) {
      return null;
    }

    // Get repository dynamically from TypeORM
    const dataSource = DataSourceProvider.get();
    const repository = dataSource.getRepository(this.{{typeColumn}});

    return await repository.findOne({ where: { id: this.{{idColumn}} } }) as T | null;
  }

{{/each}}
{{/if}}
}
